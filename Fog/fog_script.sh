#!/bin/bash

# Update package list
echo "--------------------------------------------------------------------------------------"
echo "--------------------------------------------------------------------------------------"
echo "--------------------------------------------------------------------------------------"
echo "Updating package list..."
sudo apt update

# Install system dependencies
echo "--------------------------------------------------------------------------------------"
echo "--------------------------------------------------------------------------------------"
echo "--------------------------------------------------------------------------------------"
echo "Installing system dependencies..."
sudo apt install -y espeak build-essential

# Install Ollama
echo "--------------------------------------------------------------------------------------"
echo "--------------------------------------------------------------------------------------"
echo "--------------------------------------------------------------------------------------"
echo "Installing Ollama..."
curl -fsSL https://ollama.com/install.sh | sh

# Fix permissions for Ollama shared libraries (e.g., libggml-blas.so)
echo "--------------------------------------------------------------------------------------"
echo "--------------------------------------------------------------------------------------"
echo "--------------------------------------------------------------------------------------"
echo "Fixing permissions for Ollama libraries..."
sudo chmod -R a+rX /usr/local/lib/ollama

# Pull the required model
echo "--------------------------------------------------------------------------------------"
echo "--------------------------------------------------------------------------------------"
echo "--------------------------------------------------------------------------------------"
ollama pull deepseek-r1:1.5b

# Create virtual environment if it doesn't exist
if [ ! -d ".venv" ]; then
  echo "--------------------------------------------------------------------------------------"
  echo "--------------------------------------------------------------------------------------"
  echo "--------------------------------------------------------------------------------------"
  echo "Creating virtual environment..."
  python3 -m venv .venv
fi

# Activate virtual environment
source .venv/bin/activate

# Install Python packages
echo "--------------------------------------------------------------------------------------"
echo "--------------------------------------------------------------------------------------"
echo "--------------------------------------------------------------------------------------"
echo "Installing python dependencies..."
pip install -r fog_requirements.txt